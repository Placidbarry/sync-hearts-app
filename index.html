<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sync Hearts ¬∑ Agency</title>
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Google Fonts Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,400;14..32,600;14..32,700;14..32,800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --tg-bg: var(--tg-theme-bg-color, #0b0e14);
            --tg-text: var(--tg-theme-text-color, #ffffff);
            --tg-hint: var(--tg-theme-hint-color, #8e9aaf);
            --tg-link: var(--tg-theme-link-color, #57a6ff);
            --tg-button: var(--tg-theme-button-color, #ff3b5c);
            --tg-button-text: var(--tg-theme-button-text-color, #ffffff);
            --tg-secondary-bg: var(--tg-theme-secondary-bg-color, #1e2229);
            --card-bg: #252a33;
            --border-radius-lg: 24px;
            --border-radius-md: 16px;
            --border-radius-sm: 12px;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--tg-bg);
            color: var(--tg-text);
            padding: 20px 16px 30px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background 0.2s;
        }

        .hidden {
            display: none !important;
        }

        .screen {
            display: block;
            width: 100%;
        }

        /* HEADER */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .logo {
            font-weight: 800;
            font-size: 22px;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, #ff6b6b, #ff3b5c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .credit-badge {
            background: rgba(255, 59, 92, 0.12);
            padding: 8px 14px;
            border-radius: 40px;
            font-size: 14px;
            font-weight: 600;
            color: var(--tg-button);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* FORM ELEMENTS */
        .section-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card {
            background: var(--tg-secondary-bg);
            border-radius: var(--border-radius-lg);
            padding: 20px;
            margin-bottom: 24px;
            border: 1px solid rgba(255,255,255,0.04);
        }

        .input-field {
            width: 100%;
            background: var(--card-bg);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: var(--border-radius-md);
            padding: 16px 18px;
            font-size: 16px;
            color: var(--tg-text);
            outline: none;
            transition: border 0.15s;
            margin-bottom: 16px;
        }

        .input-field:focus {
            border-color: var(--tg-button);
        }

        .input-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--tg-hint);
            margin-bottom: 8px;
        }

        .dropdown {
            width: 100%;
            background: var(--card-bg);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: var(--border-radius-md);
            padding: 16px 18px;
            font-size: 16px;
            color: var(--tg-text);
            appearance: none;
            background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='white'><path d='M7 10l5 5 5-5z'/></svg>");
            background-repeat: no-repeat;
            background-position: right 18px center;
            margin-bottom: 16px;
        }

        .gender-row {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .gender-option {
            flex: 1;
            background: var(--card-bg);
            border: 2px solid transparent;
            border-radius: var(--border-radius-md);
            padding: 14px;
            text-align: center;
            font-weight: 600;
            transition: all 0.1s;
        }

        .gender-option.selected {
            border-color: var(--tg-button);
            background: rgba(255, 59, 92, 0.08);
        }

        /* PHOTO UPLOAD */
        .photo-upload-area {
            display: flex;
            align-items: center;
            gap: 16px;
            background: var(--card-bg);
            border-radius: var(--border-radius-md);
            padding: 12px 16px;
            margin-bottom: 16px;
        }

        .photo-preview {
            width: 60px;
            height: 60px;
            border-radius: 30px;
            background: #333a45;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #b0c4ce;
            overflow: hidden;
        }

        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .btn-upload {
            background: rgba(255,255,255,0.08);
            border: 1px dashed rgba(255,255,255,0.2);
            border-radius: 40px;
            padding: 12px 20px;
            font-size: 15px;
            font-weight: 600;
            color: var(--tg-text);
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-upload:active {
            background: rgba(255,255,255,0.16);
        }

        /* BUTTONS */
        .btn-primary {
            background: var(--tg-button);
            color: var(--tg-button-text);
            border: none;
            border-radius: 60px;
            padding: 18px 24px;
            font-size: 18px;
            font-weight: 700;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: opacity 0.15s, transform 0.1s;
            margin-top: 8px;
        }

        .btn-primary:active {
            opacity: 0.85;
            transform: scale(0.98);
        }

        /* AGENT GRID */
        .agent-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 12px;
        }

        .agent-card {
            background: var(--tg-secondary-bg);
            border-radius: var(--border-radius-md);
            padding: 16px 12px;
            position: relative;
            transition: transform 0.1s;
        }

        .agent-card:active {
            transform: scale(0.98);
        }

        .agent-photos {
            display: flex;
            gap: 6px;
            margin-bottom: 12px;
        }

        .agent-thumb {
            width: 100%;
            aspect-ratio: 1 / 1;
            border-radius: 12px;
            object-fit: cover;
            border: 2px solid rgba(255,255,255,0.06);
        }

        .agent-thumb.small {
            width: 48%;
        }

        .premium-lock {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(4px);
            width: 32px;
            height: 32px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: #ffd966;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .agent-name {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .agent-meta {
            font-size: 13px;
            color: var(--tg-hint);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .agent-bio {
            font-size: 13px;
            color: var(--tg-text);
            opacity: 0.9;
            margin-bottom: 16px;
            line-height: 1.4;
        }

        .chat-btn {
            background: var(--tg-button);
            border: none;
            border-radius: 40px;
            padding: 12px;
            color: white;
            font-weight: 600;
            font-size: 14px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            cursor: pointer;
        }

        /* BOTTOM NAV */
        .bottom-nav {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background: var(--tg-secondary-bg);
            border-radius: 40px;
            padding: 8px 12px;
            margin-top: 30px;
            border: 1px solid rgba(255,255,255,0.04);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 0;
            flex: 1;
            border-radius: 30px;
            color: var(--tg-hint);
            font-size: 12px;
            gap: 4px;
            transition: background 0.1s;
        }

        .nav-item.active {
            color: var(--tg-button);
            background: rgba(255, 59, 92, 0.08);
        }

        /* MISC */
        .footer-note {
            text-align: center;
            color: var(--tg-hint);
            font-size: 12px;
            margin-top: 24px;
        }
    </style>
</head>
<body>
    <!-- ========== REGISTRATION SCREEN ========== -->
    <div id="screenRegister" class="screen">
        <div class="app-header">
            <span class="logo">‚ú® Sync Hearts</span>
            <span class="credit-badge">üíé 0 credits</span>
        </div>

        <div class="card">
            <div class="section-title">
                <span>üìã Complete registration</span>
            </div>
            
            <!-- Age -->
            <div class="input-label">Your age</div>
            <input type="number" id="ageInput" class="input-field" placeholder="e.g. 25" min="18" max="100" value="">

            <!-- Country dropdown -->
            <div class="input-label">Country</div>
            <select id="countrySelect" class="dropdown"></select>

            <!-- State / Region -->
            <div class="input-label">State / Region</div>
            <input type="text" id="stateInput" class="input-field" placeholder="e.g. California">

            <!-- Looking for -->
            <div class="input-label">I'm looking for...</div>
            <div class="gender-row" id="lookingForGroup">
                <div class="gender-option" data-value="female">üíÉ Women</div>
                <div class="gender-option" data-value="male">üï∫ Men</div>
            </div>

            <!-- Profile photo upload -->
            <div class="input-label">Your profile picture</div>
            <div class="photo-upload-area">
                <div class="photo-preview" id="photoPreview">
                    <span>üì∏</span>
                </div>
                <div class="btn-upload" id="uploadPhotoBtn">
                    ‚¨ÜÔ∏è Upload photo
                </div>
            </div>
            <input type="hidden" id="photoFileId" value="">
        </div>

        <button class="btn-primary" id="completeRegistrationBtn">
            ‚úÖ Complete & browse agents
        </button>
        <div class="footer-note">By registering you confirm you are 18+</div>
    </div>

    <!-- ========== AGENT BROWSER SCREEN (hidden by default) ========== -->
    <div id="screenAgents" class="screen hidden">
        <div class="app-header">
            <span class="logo">‚ú® Sync Hearts</span>
            <span class="credit-badge" id="creditDisplay">üíé 0 credits</span>
        </div>

        <div class="section-title">
            <span>üî• Available companions</span>
        </div>

        <!-- Agent grid will be injected here via JS -->
        <div id="agentGridContainer" class="agent-grid"></div>

        <!-- Bottom navigation (inline menu style) -->
        <div class="bottom-nav">
            <div class="nav-item active">
                <span>üë•</span>
                <span>Browse</span>
            </div>
            <div class="nav-item" id="navCredits">
                <span>üíé</span>
                <span>Buy</span>
            </div>
            <div class="nav-item" id="navProfile">
                <span>üë§</span>
                <span>Profile</span>
            </div>
            <div class="nav-item" id="navSupport">
                <span>üìû</span>
                <span>Support</span>
            </div>
        </div>
    </div>

    <script>
        // ---------- TELEGRAM INIT ----------
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();
        tg.enableClosingConfirmation();

        // ---------- GLOBAL STATE ----------
        let registrationData = {
            age: '',
            country: '',
            state: '',
            lookingFor: '',
            photoFileId: ''
        };
        let userCredits = 0; // will be updated from bot later

        // ---------- POPULATE COUNTRY DROPDOWN ----------
        const countryList = [
            "Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Argentina", "Armenia", "Australia", "Austria", "Azerbaijan",
            "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium", "Belize", "Benin", "Bhutan", "Bolivia",
            "Bosnia and Herzegovina", "Botswana", "Brazil", "Brunei", "Bulgaria", "Burkina Faso", "Burundi",
            "Cabo Verde", "Cambodia", "Cameroon", "Canada", "Central African Republic", "Chad", "Chile", "China", "Colombia",
            "Comoros", "Congo", "Costa Rica", "C√¥te d'Ivoire", "Croatia", "Cuba", "Cyprus", "Czech Republic",
            "Denmark", "Djibouti", "Dominica", "Dominican Republic",
            "Ecuador", "Egypt", "El Salvador", "Equatorial Guinea", "Eritrea", "Estonia", "Eswatini", "Ethiopia",
            "Fiji", "Finland", "France",
            "Gabon", "Gambia", "Georgia", "Germany", "Ghana", "Greece", "Grenada", "Guatemala", "Guinea", "Guinea-Bissau",
            "Guyana", "Haiti", "Honduras", "Hungary",
            "Iceland", "India", "Indonesia", "Iran", "Iraq", "Ireland", "Israel", "Italy",
            "Jamaica", "Japan", "Jordan",
            "Kazakhstan", "Kenya", "Kiribati", "Korea, North", "Korea, South", "Kosovo", "Kuwait", "Kyrgyzstan",
            "Laos", "Latvia", "Lebanon", "Lesotho", "Liberia", "Libya", "Liechtenstein", "Lithuania", "Luxembourg",
            "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", "Marshall Islands", "Mauritania", "Mauritius",
            "Mexico", "Micronesia", "Moldova", "Monaco", "Mongolia", "Montenegro", "Morocco", "Mozambique", "Myanmar",
            "Namibia", "Nauru", "Nepal", "Netherlands", "New Zealand", "Nicaragua", "Niger", "Nigeria", "North Macedonia",
            "Norway", "Oman",
            "Pakistan", "Palau", "Palestine", "Panama", "Papua New Guinea", "Paraguay", "Peru", "Philippines", "Poland",
            "Portugal", "Qatar",
            "Romania", "Russia", "Rwanda",
            "Saint Kitts and Nevis", "Saint Lucia", "Saint Vincent and the Grenadines", "Samoa", "San Marino", "Sao Tome and Principe",
            "Saudi Arabia", "Senegal", "Serbia", "Seychelles", "Sierra Leone", "Singapore", "Slovakia", "Slovenia",
            "Solomon Islands", "Somalia", "South Africa", "South Sudan", "Spain", "Sri Lanka", "Sudan", "Suriname",
            "Sweden", "Switzerland", "Syria",
            "Taiwan", "Tajikistan", "Tanzania", "Thailand", "Timor-Leste", "Togo", "Tonga", "Trinidad and Tobago",
            "Tunisia", "Turkey", "Turkmenistan", "Tuvalu",
            "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom", "United States", "Uruguay", "Uzbekistan",
            "Vanuatu", "Vatican City", "Venezuela", "Vietnam",
            "Yemen",
            "Zambia", "Zimbabwe"
        ];

        function populateCountries() {
            const select = document.getElementById('countrySelect');
            select.innerHTML = '<option value="" disabled selected>Select your country</option>';
            countryList.forEach(country => {
                const option = document.createElement('option');
                option.value = country;
                option.textContent = country;
                select.appendChild(option);
            });
        }
        populateCountries();

        // ---------- LOOKING FOR SELECTION ----------
        const genderOptions = document.querySelectorAll('.gender-option');
        genderOptions.forEach(opt => {
            opt.addEventListener('click', function() {
                genderOptions.forEach(o => o.classList.remove('selected'));
                this.classList.add('selected');
                registrationData.lookingFor = this.dataset.value;
            });
        });

        // ---------- PHOTO UPLOAD (Telegram File Picker) ----------
        document.getElementById('uploadPhotoBtn').addEventListener('click', async function() {
            tg.HapticFeedback.impactOccurred('light');
            // Telegram Web App method to open file picker (images only)
            tg.openPhotoPicker({
                max: 1,
                success: (files) => {
                    if (files && files.length > 0) {
                        const file = files[0];
                        // Get the Telegram file ID
                        const fileId = file.fileId;
                        registrationData.photoFileId = fileId;
                        document.getElementById('photoFileId').value = fileId;
                        
                        // Show preview (Telegram provides a temporary URL)
                        if (file.url) {
                            const previewDiv = document.getElementById('photoPreview');
                            previewDiv.innerHTML = `<img src="${file.url}" style="width:100%;height:100%;object-fit:cover;">`;
                        } else {
                            // fallback
                            document.getElementById('photoPreview').innerHTML = '<span>‚úÖ</span>';
                        }
                    }
                },
                fail: (error) => {
                    tg.showAlert('Photo selection cancelled or failed.');
                }
            });
        });

        // ---------- COMPLETE REGISTRATION ----------
        document.getElementById('completeRegistrationBtn').addEventListener('click', function() {
            // Validate inputs
            const age = document.getElementById('ageInput').value;
            if (!age || age < 18) {
                tg.showAlert('Please enter a valid age (18+).');
                return;
            }
            const country = document.getElementById('countrySelect').value;
            if (!country) {
                tg.showAlert('Please select your country.');
                return;
            }
            const state = document.getElementById('stateInput').value.trim();
            if (!state) {
                tg.showAlert('Please enter your state/region.');
                return;
            }
            if (!registrationData.lookingFor) {
                tg.showAlert('Please select who you are looking for.');
                return;
            }

            // Save registration data
            registrationData.age = age;
            registrationData.country = country;
            registrationData.state = state;

            // Send registration to bot
            tg.HapticFeedback.impactOccurred('medium');
            tg.sendData(JSON.stringify({
                action: 'register_client',
                age: registrationData.age,
                country: registrationData.country,
                state: registrationData.state,
                looking_for: registrationData.lookingFor,
                photo_file_id: registrationData.photoFileId || '',
                user_id: tg.initDataUnsafe?.user?.id,
                username: tg.initDataUnsafe?.user?.username,
                first_name: tg.initDataUnsafe?.user?.first_name
            }));

            // For demo, simulate success and switch to agent browser
            tg.showAlert('‚úÖ Registration sent! Loading companions...');
            switchToAgentScreen();
        });

        // ---------- SWITCH SCREENS ----------
        function switchToAgentScreen() {
            document.getElementById('screenRegister').classList.add('hidden');
            document.getElementById('screenAgents').classList.remove('hidden');
            renderAgentGrid();
            // Request credit balance from bot (will be sent via initData or we can ask)
            // For now just show 10 as placeholder
            document.getElementById('creditDisplay').innerHTML = 'üíé 10 credits';
        }

        // ---------- RENDER AGENT GRID (DEMO DATA) ----------
        // In production, this data will come from the bot via WebAppInitData or a separate sendData call.
        const demoAgents = [
            {
                id: 'agent_001',
                name: 'Sophia',
                age: 26,
                location: 'New York',
                bio: 'Soft voice, sensual talk. I love roleplay.',
                profilePics: [
                    'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=200&h=200&fit=crop',
                    'https://images.unsplash.com/photo-1524504388940-b1c1722653e1?w=200&h=200&fit=crop'
                ],
                premiumPics: 2, // number of locked pics
                verified: true
            },
            {
                id: 'agent_002',
                name: 'Emma',
                age: 24,
                location: 'London',
                bio: 'Flirty and playful. Let‚Äôs get naughty.',
                profilePics: [
                    'https://images.unsplash.com/photo-1517841905240-472988babdf9?w=200&h=200&fit=crop',
                    'https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=200&h=200&fit=crop'
                ],
                premiumPics: 3,
                verified: true
            },
            {
                id: 'agent_003',
                name: 'Mia',
                age: 28,
                location: 'Miami',
                bio: 'Passionate and open-minded. No limits.',
                profilePics: [
                    'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=200&h=200&fit=crop',
                    'https://images.unsplash.com/photo-1554151228-14d9def656e4?w=200&h=200&fit=crop'
                ],
                premiumPics: 2,
                verified: false
            },
            {
                id: 'agent_004',
                name: 'Lisa',
                age: 22,
                location: 'Berlin',
                bio: 'College girl, curious and kinky.',
                profilePics: [
                    'https://images.unsplash.com/photo-1531746020798-e6953c6e8e04?w=200&h=200&fit=crop',
                    'https://images.unsplash.com/photo-1524250502761-1ac6f2e30d43?w=200&h=200&fit=crop'
                ],
                premiumPics: 4,
                verified: true
            }
        ];

        function renderAgentGrid() {
            const container = document.getElementById('agentGridContainer');
            container.innerHTML = '';
            demoAgents.forEach(agent => {
                const card = document.createElement('div');
                card.className = 'agent-card';
                card.dataset.agentId = agent.id;

                // Photos grid (first two profile pics)
                let photosHtml = `<div class="agent-photos">`;
                agent.profilePics.slice(0, 2).forEach((pic, index) => {
                    photosHtml += `<img src="${pic}" class="agent-thumb ${agent.profilePics.length > 1 ? 'small' : ''}" alt="profile">`;
                });
                photosHtml += `</div>`;

                // Premium lock if has premium pics
                const lockHtml = agent.premiumPics > 0 ? `<div class="premium-lock">üîí${agent.premiumPics}</div>` : '';

                // Verified badge
                const verifiedBadge = agent.verified ? '‚úì' : '';

                card.innerHTML = `
                    ${lockHtml}
                    ${photosHtml}
                    <div class="agent-name">${agent.name}, ${agent.age} ${verifiedBadge}</div>
                    <div class="agent-meta">üìç ${agent.location}</div>
                    <div class="agent-bio">${agent.bio}</div>
                    <button class="chat-btn" data-agent-id="${agent.id}" data-agent-name="${agent.name}">
                        üí¨ Chat now
                    </button>
                `;
                container.appendChild(card);
            });

            // Attach event listeners to chat buttons
            document.querySelectorAll('.chat-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const agentId = this.dataset.agentId;
                    const agentName = this.dataset.agentName;
                    requestChat(agentId, agentName);
                });
            });
        }

        // ---------- REQUEST CHAT (PAY & CONNECT) ----------
        function requestChat(agentId, agentName) {
            tg.HapticFeedback.impactOccurred('heavy');
            tg.showConfirm(`üíé Start private chat with ${agentName}? (1 credit)`, (confirmed) => {
                if (confirmed) {
                    tg.sendData(JSON.stringify({
                        action: 'request_chat',
                        agent_id: agentId,
                        agent_name: agentName,
                        client_id: tg.initDataUnsafe?.user?.id,
                        timestamp: Date.now()
                    }));
                    tg.showAlert('‚è≥ Searching for available agent... you will be notified.');
                    // In production, bot will handle waiting room.
                    // For demo, close mini app.
                    setTimeout(() => tg.close(), 1500);
                }
            });
        }

        // ---------- BOTTOM NAVIGATION (Placeholders) ----------
        document.getElementById('navCredits').addEventListener('click', function() {
            tg.HapticFeedback.impactOccurred('light');
            tg.sendData(JSON.stringify({ action: 'buy_credits' }));
            tg.showAlert('üíé Redirecting to payment...');
            tg.close();
        });

        document.getElementById('navProfile').addEventListener('click', function() {
            tg.HapticFeedback.impactOccurred('light');
            tg.sendData(JSON.stringify({ action: 'view_profile' }));
            tg.showAlert('üë§ Viewing your profile');
            tg.close();
        });

        document.getElementById('navSupport').addEventListener('click', function() {
            tg.HapticFeedback.impactOccurred('light');
            tg.sendData(JSON.stringify({ action: 'support' }));
            tg.showAlert('üìû Support will contact you soon');
            tg.close();
        });

        // ---------- INITIAL CREDITS FROM BOT (if passed via initData) ----------
        // For demo we set default
        window.addEventListener('load', function() {
            // If initData contains user credits, we could parse it.
            // Currently we just show placeholder.
        });

        console.log('HTML Mini App ready.');
    </script>
</body>
</html>
